{"version":3,"file":"load.js","sources":["../src/load.ts"],"sourcesContent":["export const matchPlatform = (\n    platform: string,\n    arch: string,\n    isMusl: () => boolean,\n): string => {\n    const platformArchMap: { [key: string]: { [key: string]: string | null } } =\n        {\n            android: {\n                arm64: null,\n                arm: null,\n            },\n            win32: {\n                x64: 'x86_64-pc-windows-msvc',\n                arm64: 'aarch64-pc-windows-msvc',\n            },\n            darwin: {\n                x64: 'x86_64-apple-darwin',\n                arm64: 'aarch64-apple-darwin',\n            },\n            freebsd: {\n                x64: 'x86_64-unknown-freebsd',\n            },\n            linux: {\n                x64: isMusl() ? null : 'x86_64-unknown-linux-gnu',\n                arm64: isMusl() ? null : 'aarch64-unknown-linux-gnu',\n                arm: null,\n                riscv64: isMusl() ? null : 'riscv64gc-unknown-linux-gnu',\n                s390x: 's390x-unknown-linux-gnu',\n            },\n        };\n    return platformArchMap?.[platform]?.[arch] ?? 'wasm32-wasip1';\n};\n\nexport const getBinaryFile = async (\n    platform: string,\n    version: string,\n    proxy = 'https://github.com',\n) => {\n    const fileName = getBinName(platform);\n    console.log(`using gh proxy ${proxy}`);\n    const binary = await fetch(\n        proxy +\n            `/KonghaYao/cn-font-split/releases/download/${version}/${fileName}`,\n    ).then((res) => {\n        if (res.ok) return res.arrayBuffer();\n        throw new Error('download error');\n    });\n    return binary;\n};\n\ninterface Release {\n    id: number;\n    tag: string;\n    author: string;\n    name: string;\n    draft: boolean;\n    prerelease: boolean;\n    createdAt: string;\n    publishedAt: string;\n    markdown: string;\n    html: string;\n}\n\n/** 直接拿最后一个版本的信息 */\nexport const getLatestVersion = async () => {\n    const data: {\n        release: Release;\n    } = await fetch(\n        `https://ungh.cc/repos/KonghaYao/cn-font-split/releases/latest`,\n    ).then((res) => res.json());\n    return data.release;\n};\nexport const getVersionBinary = async (\n    v = 'latest',\n): Promise<Release | undefined> => {\n    if (v === 'latest') return getLatestVersion();\n    const versions = await getAllVersions();\n    return versions.find((i: any) => i.tag === v);\n};\nexport const getAllVersions = async (): Promise<Release[]> => {\n    const { releases } = await fetch(\n        'https://ungh.cc/repos/KonghaYao/cn-font-split/releases',\n    ).then((res) => res.json());\n    return releases;\n};\n\nexport function getBinName(platform: string) {\n    const ext = platform.includes('windows')\n        ? 'dll'\n        : platform.includes('darwin')\n        ? 'dylib'\n        : platform.includes('wasm')\n        ? 'wasm'\n        : 'so';\n    const fileName = `libffi-${platform}.${ext}`;\n    return fileName;\n}\n"],"names":["matchPlatform","platform","arch","isMusl","getBinName","ext"],"mappings":"gFAAO,MAAMA,EAAgB,CACzBC,EACAC,EACAC,KAGI,CACI,QAAS,CACL,MAAO,KACP,IAAK,IAAA,EAET,MAAO,CACH,IAAK,yBACL,MAAO,yBAAA,EAEX,OAAQ,CACJ,IAAK,sBACL,MAAO,sBAAA,EAEX,QAAS,CACL,IAAK,wBAAA,EAET,MAAO,CACH,IAAKA,IAAW,KAAO,2BACvB,MAAOA,IAAW,KAAO,4BACzB,IAAK,KACL,QAASA,IAAW,KAAO,8BAC3B,MAAO,yBAAA,CACX,KAEiBF,CAAQ,IAAIC,CAAI,GAAK,gBAwD3C,SAASE,EAAWH,EAAkB,CACzC,MAAMI,EAAMJ,EAAS,SAAS,SAAS,EACjC,MACAA,EAAS,SAAS,QAAQ,EAC1B,QACAA,EAAS,SAAS,MAAM,EACxB,OACA,KAEN,MADiB,UAAUA,CAAQ,IAAII,CAAG,EAE9C"}