{"version":3,"file":"obj.js","sources":["../../../../../../../../../../../../node_modules/.pnpm/@xan105+is@2.10.1/node_modules/@xan105/is/lib/is/type/obj.js"],"sourcesContent":["/*\nCopyright (c) Anthony Beaumont\nThis source code is licensed under the MIT License\nfound in the LICENSE file in the root directory of this source tree.\n*/\n\nimport { Failure } from \"@xan105/error\";\nimport { isArray } from \"./array.js\";\nimport { shouldObj } from \"../../assert/type/obj.js\";\nimport { shouldArrayOfString } from \"../../assert/type/array.js\";\n\nfunction hasTag(value, name){\n  const tag = `[object ${name}]`;\n  return Object.prototype.toString.call(value) === tag;\n}\n\nfunction isObj(value){ //as in a \"plain obj\" and not a JS obj so {}, new Object() and Object.create(null)\n  if(value){\n    if (hasTag(value, \"Object\")) return true;\n    const prototype = Object.getPrototypeOf(value);\n    if (prototype === null  || prototype === Object.prototype) return true;\n  }\n  return false;\n}\n\nfunction isObjNotEmpty(value){\n  if (!isObj(value)) return false;\n  return Object.keys(value).length > 0;\n}\n\nfunction isObjWithProperties(value, prop){\n  shouldArrayOfString(prop);\n  if (!isObj(value)) return false;\n  for (const name of prop) {\n    if(!Object.hasOwn(value, name)) return false;\n  }\n  return true;\n}\n\nfunction isObjLike(value, schema){\n  shouldObj(schema);\n  if (!isObj(value)) return false;\n  \n  const test = (fn, ctx, args = []) => {\n    try{\n      return fn(ctx, ...args);\n    }catch(err){\n      if (err instanceof Failure)\n        throw new Failure(`Schema test function [${fn.name}()] failed !`, { code: 0, cause: err })\n      return false;\n    }\n  };\n\n  for (const name in schema) { \n    if(!Object.hasOwn(schema, name)) continue; //safe iteration\n    const targetHas = Object.hasOwn(value, name); \n\n    if (isObj(schema[name])) { //recursive | nested obj\n      if(!targetHas) return false; //target missing a required prop\n      if (isObjLike(value[name], schema[name]) === true) continue;\n      else return false;\n    }\n    else if (typeof schema[name] === \"function\"){ //simple call | shortcut\n      if(!targetHas) return false; //target missing a required prop\n      if (test(schema[name], value[name]) === true) continue;\n      else return false;\n    }\n    else if (isArray(schema[name])){ //detailed call\n      \n      const [ fn, args, option ] = schema[name];\n      \n      if (typeof fn !== \"function\" || !isArray(args)) \n        throw new Failure(\"Invalid schema ! Expected array as [function, [args]]\", { code: 1, info: { name, type: typeof schema[name], value: schema[name] } });\n\n      if(!targetHas){ //target missing a required prop\n        if(option?.optional === true) continue; //ignore it if flagged as optional\n        else return false;\n      }\n\n      if (test(fn, value[name], args) === true) continue;\n      else return false;\n    }  \n    else{\n      throw new Failure(\"Invalid schema ! Expected function or array as [function, [args]]\", { code: 1, info: { name, type: typeof schema[name], value: schema[name] } });\n    }\n  }\n  \n  return true;\n}\n\nfunction isObjWithinObj(value){\n  return isObjNotEmpty(value) && Object.values(value).every(elem => isObj(elem));\n}\n\nfunction isError(value){ \n  return hasTag(value, \"Error\"); //TC39 Error.isError()\n}\n\nfunction isRegExp(value){\n  return hasTag(value, \"RegExp\");\n}\n\nfunction isUint8Array(value){\n  //This also works for Node's Buffer since it's a subclass of Uint8Array\n  return hasTag(value, \"Uint8Array\");\n}\n\nfunction isPromise(value){\n  return hasTag(value, \"Promise\") && typeof value.then === \"function\";\n}\n\nfunction isFunction(value){\n  return typeof value === \"function\";\n}\n\nexport { \n  isObj, \n  isObjNotEmpty,\n  isObjWithProperties,\n  isObjLike,\n  isObjWithinObj,\n  isError,\n  isRegExp,\n  isUint8Array,\n  isUint8Array as isBuffer, //alias (backward compatibility)\n  isPromise,\n  isFunction\n}"],"names":["hasTag","value","name","tag","isObj","prototype","isObjNotEmpty","isObjWithinObj","elem","isError","isRegExp","isFunction"],"mappings":"gFAWA,SAASA,EAAOC,EAAOC,EAAK,CAC1B,MAAMC,EAAM,WAAWD,CAAI,IAC3B,OAAO,OAAO,UAAU,SAAS,KAAKD,CAAK,IAAME,CACnD,CAEA,SAASC,EAAMH,EAAM,CACnB,GAAGA,EAAM,CACP,GAAID,EAAOC,EAAO,QAAQ,EAAG,MAAO,GACpC,MAAMI,EAAY,OAAO,eAAeJ,CAAK,EAC7C,GAAII,IAAc,MAASA,IAAc,OAAO,UAAW,MAAO,EACpE,CACA,MAAO,EACT,CAEA,SAASC,EAAcL,EAAM,CAC3B,OAAKG,EAAMH,CAAK,EACT,OAAO,KAAKA,CAAK,EAAE,OAAS,EADT,EAE5B,CA8DA,SAASM,EAAeN,EAAM,CAC5B,OAAOK,EAAcL,CAAK,GAAK,OAAO,OAAOA,CAAK,EAAE,MAAMO,GAAQJ,EAAMI,CAAI,CAAC,CAC/E,CAEA,SAASC,EAAQR,EAAM,CACrB,OAAOD,EAAOC,EAAO,OAAO,CAC9B,CAEA,SAASS,EAAST,EAAM,CACtB,OAAOD,EAAOC,EAAO,QAAQ,CAC/B,CAWA,SAASU,EAAWV,EAAM,CACxB,OAAO,OAAOA,GAAU,UAC1B","x_google_ignoreList":[0]}