{"version":3,"file":"init.js","sources":["../src/init.ts"],"sourcesContent":["import { execFile, spawn } from 'child_process';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\nimport { dirname } from 'path';\n\n// @ts-ignore 获取当前模块的 URL\nconst __filename = fileURLToPath(import.meta.url);\n\n// 获取当前模块所在的目录\nconst __dirname = dirname(__filename);\n\nexport function runInitScript() {\n    const isWindows = process.platform === 'win32';\n\n    // 获取除程序名和当前脚本外的所有命令行参数\n    const args = process.argv.slice(2);\n\n    if (isWindows) {\n        // Windows平台下运行Powershell脚本\n        const scriptPath = path.resolve(__dirname, './init.ps1');\n        const powershellArgs = [\n            '-ExecutionPolicy',\n            'Bypass',\n            '-File',\n            scriptPath,\n            ...args,\n        ];\n        return new Promise((resolve, reject) => {\n            execFile(\n                'powershell.exe',\n                powershellArgs,\n                (error, stdout, stderr) => {\n                    if (error) {\n                        console.error(\n                            `Error executing PowerShell script: ${error.message}`,\n                        );\n                        reject(error);\n                        return;\n                    }\n                    resolve(null);\n                    console.log(`PowerShell script output: ${stdout}`);\n                },\n            );\n        });\n    } else {\n        // 非Windows平台（如Linux或macOS）下运行shell脚本\n        const scriptPath = path.resolve(__dirname, './init.sh');\n        const child = spawn('bash', [scriptPath, ...args], {\n            stdio: 'inherit',\n        });\n        return new Promise((resolve, reject) => {\n            child\n                .on('close', (code) => {\n                    if (code !== 0) {\n                        reject();\n                        console.error(`Shell script exited with code ${code}`);\n                    } else {\n                        resolve(null);\n                        console.log('Shell script executed successfully.');\n                    }\n                })\n                .on('error', (err) => {\n                    reject(err);\n                    console.error('Failed to start shell script:', err);\n                });\n        });\n    }\n}\n"],"names":["__filename","fileURLToPath","__dirname","dirname","runInitScript","isWindows","args","powershellArgs","path","resolve","reject","execFile","error","stdout","stderr","scriptPath","child","spawn","code","err"],"mappings":"0MAMA,MAAMA,EAAaC,EAAAA,sKAA6B,EAG1CC,EAAYC,EAAAA,QAAQH,CAAU,EAE7B,SAASI,GAAgB,CAC5B,MAAMC,EAAY,QAAQ,WAAa,QAGjCC,EAAO,QAAQ,KAAK,MAAM,CAAC,EAEjC,GAAID,EAAW,CAGX,MAAME,EAAiB,CACnB,mBACA,SACA,QAJeC,EAAK,QAAQN,EAAW,YAAY,EAMnD,GAAGI,CAAA,EAEP,OAAO,IAAI,QAAQ,CAACG,EAASC,IAAW,CACpCC,EAAAA,SACI,iBACAJ,EACA,CAACK,EAAOC,EAAQC,IAAW,CACvB,GAAIF,EAAO,CACP,QAAQ,MACJ,sCAAsCA,EAAM,OAAO,EAAA,EAEvDF,EAAOE,CAAK,EACZ,MACJ,CACAH,EAAQ,IAAI,EACZ,QAAQ,IAAI,6BAA6BI,CAAM,EAAE,CACrD,CAAA,CAER,CAAC,CACL,KAAO,CAEH,MAAME,EAAaP,EAAK,QAAQN,EAAW,WAAW,EAChDc,EAAQC,EAAAA,MAAM,OAAQ,CAACF,EAAY,GAAGT,CAAI,EAAG,CAC/C,MAAO,SAAA,CACV,EACD,OAAO,IAAI,QAAQ,CAACG,EAASC,IAAW,CACpCM,EACK,GAAG,QAAUE,GAAS,CACfA,IAAS,GACTR,EAAA,EACA,QAAQ,MAAM,iCAAiCQ,CAAI,EAAE,IAErDT,EAAQ,IAAI,EACZ,QAAQ,IAAI,qCAAqC,EAEzD,CAAC,EACA,GAAG,QAAUU,GAAQ,CAClBT,EAAOS,CAAG,EACV,QAAQ,MAAM,gCAAiCA,CAAG,CACtD,CAAC,CACT,CAAC,CACL,CACJ"}