{"version":3,"file":"isMusl.js","sources":["../../src/node/isMusl.ts"],"sourcesContent":["import { readFileSync } from 'fs';\nimport { execSync } from 'child_process';\nimport path from 'path';\nexport const isMusl = () => {\n    let musl: boolean | null = false;\n    if (process.platform === 'linux') {\n        musl = isMuslFromFilesystem();\n        if (musl === null) {\n            musl = isMuslFromReport();\n        }\n        if (musl === null) {\n            musl = isMuslFromChildProcess();\n        }\n    }\n    return !!musl;\n};\n\nexport const isMuslFromFilesystem = () => {\n    try {\n        return readFileSync('/usr/bin/ldd', 'utf-8').includes('musl');\n    } catch {\n        return null;\n    }\n};\n\nexport const isMuslFromReport = () => {\n    const report: any =\n        typeof process.report.getReport === 'function'\n            ? process.report.getReport()\n            : null;\n    if (!report) {\n        return null;\n    }\n    if (report.header && report.header.glibcVersionRuntime) {\n        return false;\n    }\n    if (Array.isArray(report.sharedObjects)) {\n        if (\n            report.sharedObjects.some(\n                (f: string) =>\n                    f.includes('libc.musl-') || f.includes('ld-musl-'),\n            )\n        ) {\n            return true;\n        }\n    }\n    return false;\n};\n\nexport const isMuslFromChildProcess = () => {\n    try {\n        return execSync('ldd --version', { encoding: 'utf8' }).includes('musl');\n    } catch (e) {\n        // If we reach this case, we don't know if the system is musl or not, so is better to just fallback to false\n        return false;\n    }\n};\n"],"names":["isMusl","musl","isMuslFromFilesystem","isMuslFromReport","isMuslFromChildProcess","readFileSync","report","f","execSync"],"mappings":"iIAGaA,EAAS,IAAM,CACxB,IAAIC,EAAuB,GAC3B,OAAI,QAAQ,WAAa,UACrBA,EAAOC,EAAA,EACHD,IAAS,OACTA,EAAOE,EAAA,GAEPF,IAAS,OACTA,EAAOG,EAAA,IAGR,CAAC,CAACH,CACb,EAEaC,EAAuB,IAAM,CACtC,GAAI,CACA,OAAOG,EAAAA,aAAa,eAAgB,OAAO,EAAE,SAAS,MAAM,CAChE,MAAQ,CACJ,OAAO,IACX,CACJ,EAEaF,EAAmB,IAAM,CAClC,MAAMG,EACF,OAAO,QAAQ,OAAO,WAAc,WAC9B,QAAQ,OAAO,UAAA,EACf,KACV,OAAKA,EAGDA,EAAO,QAAUA,EAAO,OAAO,oBACxB,GAEP,SAAM,QAAQA,EAAO,aAAa,GAE9BA,EAAO,cAAc,KAChBC,GACGA,EAAE,SAAS,YAAY,GAAKA,EAAE,SAAS,UAAU,CAAA,GATtD,IAgBf,EAEaH,EAAyB,IAAM,CACxC,GAAI,CACA,OAAOI,EAAAA,SAAS,gBAAiB,CAAE,SAAU,OAAQ,EAAE,SAAS,MAAM,CAC1E,MAAY,CAER,MAAO,EACX,CACJ"}